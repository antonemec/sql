<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§—ñ–Ω–∞–Ω—Å–æ–≤–∏–π –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        /* === –ë–∞–∑–æ–≤—ñ —Å—Ç–∏–ª—ñ —Ç–∞ —à—Ä–∏—Ñ—Ç–∏ === */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* –°–≤—ñ—Ç–ª—ñ—à–∏–π —Ñ–æ–Ω */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .game-container {
            background-color: #ffffff;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px; 
            text-align: center;
        }

        /* === –ê–Ω—ñ–º–∞—Ü—ñ—ó –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ === */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-3px); }
            40%, 80% { transform: translateX(3px); }
        }

        /* === –°—Ç–∏–ª—ñ –¥–ª—è SVG –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ === */
        .character-area {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 15px;
            background: #eef2ff; /* –î—É–∂–µ —Å–≤—ñ—Ç–ª–æ-—Å–∏–Ω—ñ–π */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .character-svg-wrapper {
            width: 80px;
            height: 80px;
            display: inline-block;
            transform-origin: bottom;
            transition: transform 0.3s ease-in-out;
            animation: pulse 2.5s infinite ease-in-out;
            position: relative;
        }

        /* --- SVG-—á–∞—Å—Ç–∏–Ω–∏ —Ç–∞ —ó—Ö –ø–µ—Ä–µ—Ö–æ–¥–∏ --- */
        .character-svg-wrapper svg .mouth, .character-svg-wrapper svg .eyebrow {
            transition: all 0.3s ease-in-out;
            transform-origin: center center;
        }

        /* --- –°–¢–ê–ù–ò --- */
        .character-svg-wrapper.error { animation: shake 0.5s 3; }
        .character-svg-wrapper.error .mouth { d: path("M 30 55 Q 40 50 50 55"); } /* –°—É–º–Ω–∏–π —Ä–æ—Ç */
        .character-svg-wrapper.error .eyebrow { transform: translateY(2px) rotate(5deg); } /* –ó–≤–µ–¥–µ–Ω—ñ –±—Ä–æ–≤–∏ */
        
        .character-svg-wrapper.thinking { background-color: #fef3c7; border-radius: 50%; }
        .character-svg-wrapper.thinking .mouth { d: path("M 30 55 Q 40 58 50 55"); } /* –õ–µ–≥–∫–∞ –ø–æ—Å–º—ñ—à–∫–∞ */
        
        .character-svg-wrapper.victory { animation: pulse 1s infinite; } 
        .character-svg-wrapper.victory .mouth { d: path("M 25 50 Q 40 65 55 50"); } /* –®–∏—Ä–æ–∫–∞ —É—Å–º—ñ—à–∫–∞ */


        .character-text {
            font-size: 1rem;
            color: #374151;
            font-weight: 600;
            min-height: 25px;
            margin-top: 10px;
            background: #ffffff;
            padding: 8px 15px;
            border-radius: 10px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        /* === –ö–Ω–æ–ø–∫–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è === */
        .btn {
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 700;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2);
            border: none;
            color: white;
            cursor: pointer;
        }
        .btn:active:not(.disabled) {
            transform: translateY(3px);
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2);
        }
        .btn.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è —Å–µ–∫—Ü—ñ–π */
        .resource-card {
            background-color: #f9fafb;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border: 1px solid #e5e7eb;
            font-weight: 700;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .total-wealth {
            font-size: 1.5rem;
            color: #1f2937;
        }

        /* –°–µ–∫—Ü—ñ—è —Ä–æ–∑–ø–æ–¥—ñ–ª—É –∫–æ—à—Ç—ñ–≤ */
        .allocation-section {
            background: #f0fdf4; /* –°–≤—ñ—Ç–ª–æ-–∑–µ–ª–µ–Ω–∏–π —Ñ–æ–Ω */
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            border: 2px solid #34d399;
        }
        .input-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .input-group label {
            width: 100px;
            text-align: left;
            font-size: 0.9rem;
            color: #10b981;
            font-weight: 600;
        }
        .input-group input {
            width: 100px;
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
            text-align: right;
        }
        .allocation-button {
            background-color: #10b981;
            box-shadow: 0 4px 0 #059669;
            margin-top: 15px;
        }
    </style>
</head>
<body>

<div class="game-container">
    <h1 class="text-3xl font-extrabold text-gray-800 mb-2">–§—ñ–Ω–∞–Ω—Å–æ–≤–∏–π –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫</h1>
    <p class="text-gray-500 mb-4">–†–æ–∑–ø–æ–¥—ñ–ª–∏ –∫–æ—à—Ç–∏, —â–æ–± –º–∞–∫—Å–∏–º—ñ–∑—É–≤–∞—Ç–∏ –∑–∞–≥–∞–ª—å–Ω–∏–π –∫–∞–ø—ñ—Ç–∞–ª –∑–∞ 12 –º—ñ—Å—è—Ü—ñ–≤!</p>

    <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∞ –ø–∞–Ω–µ–ª—å -->
    <div class="flex justify-between items-center mb-4">
        <div class="text-lg font-bold text-blue-600">
            –ú—ñ—Å—è—Ü—å: <span id="current-month">1 / 12</span>
        </div>
        <div class="total-wealth font-extrabold text-green-700">
            –ö–∞–ø—ñ—Ç–∞–ª: <span id="total-wealth">1000</span> –≥—Ä–Ω
        </div>
    </div>
    
    <!-- –°–µ–∫—Ü—ñ—è –ü–µ—Ä—Å–æ–Ω–∞–∂–∞ -->
    <div class="character-area">
        <div class="character-svg-wrapper" id="character-svg-wrapper">
            <svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
                <!-- –¢—ñ–ª–æ (–ö–æ—Ä–ø—É—Å-–ú–æ–Ω–µ—Ç–∞) -->
                <circle cx="40" cy="40" r="35" fill="#facc15"/>
                <circle cx="40" cy="40" r="30" fill="#fef08a"/>
                <text x="40" y="45" font-size="20" font-weight="900" fill="#f97316" text-anchor="middle">G</text> 
                
                <!-- –û—á—ñ -->
                <circle cx="30" cy="30" r="4" fill="black"/>
                <circle cx="50" cy="30" r="4" fill="black"/>
                
                <!-- –ë—Ä–æ–≤–∏ (–¥–ª—è –µ–º–æ—Ü—ñ–π) -->
                <path d="M25 25 C30 20 35 20" stroke="black" stroke-width="2" stroke-linecap="round" fill="none" class="eyebrow"/>
                <path d="M45 20 C50 15 55 20" stroke="black" stroke-width="2" stroke-linecap="round" fill="none" class="eyebrow"/>

                <!-- –†–æ—Ç (–¥–ª—è –µ–º–æ—Ü—ñ–π) -->
                <path d="M 30 50 Q 40 55 50 50" stroke="black" stroke-width="2" stroke-linecap="round" fill="none" class="mouth"/>
            </svg>
        </div>
        <div class="character-text" id="character-text">–ü—Ä–∏–≤—ñ—Ç! –ü–æ—á–Ω–µ–º–æ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è?</div>
    </div>

    <!-- –†–µ—Å—É—Ä—Å–∏ -->
    <div class="resource-cards">
        <div class="resource-card bg-yellow-500/10 text-yellow-700">
            <span>üíµ –ì–æ—Ç—ñ–≤–∫–∞ (Cash)</span>
            <span id="cash-display">0</span>
        </div>
        <div class="resource-card bg-red-500/10 text-red-700">
            <span>üî• –ë–æ—Ä–≥ (Debt)</span>
            <span id="debt-display">0</span>
        </div>
        <div class="resource-card bg-green-500/10 text-green-700">
            <span>üìà –Ü–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó (Investment)</span>
            <span id="investment-display">0</span>
        </div>
        <div class="resource-card bg-blue-500/10 text-blue-700">
            <span>üõ°Ô∏è –ó–∞–æ—â–∞–¥–∂–µ–Ω–Ω—è (Savings)</span>
            <span id="savings-display">0</span>
        </div>
    </div>

    <button id="start-button" class="btn bg-blue-600 hover:bg-blue-700 mt-5" style="box-shadow: 0 4px 0 #1e40af;">
        –ü–û–ß–ê–¢–ò –ü–õ–ê–ù–£–í–ê–ù–ù–Ø
    </button>
    
    <!-- –°–µ–∫—Ü—ñ—è —Ä–æ–∑–ø–æ–¥—ñ–ª—É –∫–æ—à—Ç—ñ–≤ (–≤–∏–¥–∏–º–∞ —Ç—ñ–ª—å–∫–∏ –ø—ñ–¥ —á–∞—Å –≥—Ä–∏) -->
    <div id="allocation-ui" class="allocation-section hidden">
        <h3 class="text-xl font-bold text-gray-700 mb-3">–†–æ–∑–ø–æ–¥—ñ–ª –∫–æ—à—Ç—ñ–≤:</h3>
        
        <div id="event-message" class="mb-4 p-2 rounded text-sm font-medium bg-white text-gray-700">
            –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ—ó...
        </div>

        <div class="input-group">
            <label>–ü–æ–≥–∞—Å–∏—Ç–∏ –ë–æ—Ä–≥ (üî•)</label>
            <input type="number" id="input-debt" value="0" min="0" oninput="validateAllocation()">
        </div>
        <div class="input-group">
            <label>–Ü–Ω–≤–µ—Å—Ç—É–≤–∞—Ç–∏ (üìà)</label>
            <input type="number" id="input-investment" value="0" min="0" oninput="validateAllocation()">
        </div>
        <div class="input-group">
            <label>–ó–∞–æ—â–∞–¥–∏—Ç–∏ (üõ°Ô∏è)</label>
            <input type="number" id="input-savings" value="0" min="0" oninput="validateAllocation()">
        </div>
        
        <div id="remaining-cash" class="text-sm font-semibold mt-2 text-gray-600">–ó–∞–ª–∏—à–æ–∫ –≥–æ—Ç—ñ–≤–∫–∏: <span class="text-green-600">0</span> –≥—Ä–Ω</div>

        <button id="allocate-button" class="btn allocation-button w-full hover:bg-green-600 disabled:opacity-50">
            –ü–ï–†–ï–ô–¢–ò –î–û –ù–ê–°–¢–£–ü–ù–û–ì–û –ú–Ü–°–Ø–¶–Ø
        </button>
    </div>
</div>

<script>
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è DOM –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
    const startButton = document.getElementById('start-button');
    const allocateButton = document.getElementById('allocate-button');
    const allocationUI = document.getElementById('allocation-ui');
    const characterSvgWrapper = document.getElementById('character-svg-wrapper');
    const characterText = document.getElementById('character-text');
    const monthDisplay = document.getElementById('current-month');
    const totalWealthDisplay = document.getElementById('total-wealth');
    const eventMessage = document.getElementById('event-message');
    const remainingCashDisplay = document.querySelector('#remaining-cash span');

    // –î–∏—Å–ø–ª–µ—ó —Ä–µ—Å—É—Ä—Å—ñ–≤
    const cashDisplay = document.getElementById('cash-display');
    const debtDisplay = document.getElementById('debt-display');
    const investmentDisplay = document.getElementById('investment-display');
    const savingsDisplay = document.getElementById('savings-display');

    // –ü–æ–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è
    const inputDebt = document.getElementById('input-debt');
    const inputInvestment = document.getElementById('input-investment');
    const inputSavings = document.getElementById('input-savings');

    // === –Ü–≥—Ä–æ–≤—ñ –ó–º—ñ–Ω–Ω—ñ ===
    let gameData = {};
    let currentMonth = 0;
    const MAX_MONTHS = 12;
    let audioContext = null; // –î–ª—è –≤–∏—Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º–∏ –∑—ñ –∑–≤—É–∫–æ–º

    // === –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ó–≤—É–∫—É (–§—ñ–∫—Å –¥–ª—è AudioContext) ===
    function initAudioContext() {
        if (!audioContext) {
            try {
                // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è –ø–µ—Ä—à–æ–≥–æ –∫–ª—ñ–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.error("AudioContext initialization failed:", e);
                // –ó–∞–ª–∏—à–∞—î–º–æ audioContext null, —è–∫—â–æ –ø–æ–º–∏–ª–∫–∞
            }
        }
    }

    function playTone(freq, duration = 0.1) {
        if (!audioContext) return; // –ù–µ –≥—Ä–∞—î–º–æ, —è–∫—â–æ AudioContext –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ

        try {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + duration);

            oscillator.start();
            oscillator.stop(audioContext.currentTime + duration);
        } catch (e) {
            console.error("Error playing tone:", e);
        }
    }

    // === –õ–æ–≥—ñ–∫–∞ –ü–µ—Ä—Å–æ–Ω–∞–∂–∞ —Ç–∞ UI ===
    function setCharacterState(state = 'idle', text = '') {
        characterSvgWrapper.classList.remove('error', 'thinking', 'victory');
        if (state !== 'idle') {
            characterSvgWrapper.classList.add(state);
        }
        if (text) {
            characterText.textContent = text;
        }
    }

    function updateUI() {
        cashDisplay.textContent = Math.round(gameData.cash);
        debtDisplay.textContent = Math.round(gameData.debt);
        investmentDisplay.textContent = Math.round(gameData.investment);
        savingsDisplay.textContent = Math.round(gameData.savings);

        gameData.totalWealth = gameData.cash + gameData.investment + gameData.savings - gameData.debt;
        totalWealthDisplay.textContent = Math.round(gameData.totalWealth);
        monthDisplay.textContent = `${currentMonth} / ${MAX_MONTHS}`;
        
        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–ª—å–æ—Ä—É –∫–∞–ø—ñ—Ç–∞–ª—É
        totalWealthDisplay.classList.toggle('text-green-700', gameData.totalWealth >= 1000);
        totalWealthDisplay.classList.toggle('text-red-700', gameData.totalWealth < 1000);
    }
    
    // === –Ü–≥—Ä–æ–≤–∞ –õ–æ–≥—ñ–∫–∞ ===

    // –í–∏–ø–∞–¥–∫–æ–≤—ñ –ø–æ–¥—ñ—ó –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –º—ñ—Å—è—Ü—è
    const events = [
        { name: "–ó–∞—Ä–ø–ª–∞—Ç–∞", cash: 500, type: 'good', sound: 600, advice: "–ì–∞—Ä–Ω–∏–π –ø–æ—á–∞—Ç–æ–∫! –ü–∞–º'—è—Ç–∞–π –ø—Ä–æ –±–æ—Ä–≥–∏." },
        { name: "–ù–µ—Å–ø–æ–¥—ñ–≤–∞–Ω–∏–π —Ä–∞—Ö—É–Ω–æ–∫", cash: -200, type: 'bad', sound: 200, advice: "–û—Ö, –Ω–µ–ø–µ—Ä–µ–¥–±–∞—á–µ–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏. –¢—Ä–µ–±–∞ –µ–∫–æ–Ω–æ–º–∏—Ç–∏!" },
        { name: "–ë–æ–Ω—É—Å –≤—ñ–¥ —Ä–æ–±–æ—Ç–∏", cash: 350, type: 'good', sound: 700, advice: "–í—ñ–¥–º—ñ–Ω–Ω–æ! –ß–∞—Å –ø–æ–¥—É–º–∞—Ç–∏ –ø—Ä–æ —ñ–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó." },
        { name: "–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –∑–∞—Ä–ø–ª–∞—Ç–∞", cash: 100, type: 'neutral', sound: 500, advice: "–¶–µ –±–∞–∑–æ–≤—ñ –Ω–∞–¥—Ö–æ–¥–∂–µ–Ω–Ω—è. –ü–ª–∞–Ω—É–π —Ä–æ–∑—É–º–Ω–æ." },
        { name: "–ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –ø–æ–¥–∞—Ç–∫—É", cash: 150, type: 'good', sound: 650, advice: "–ù–µ–≤–µ–ª–∏–∫–∏–π, –∞–ª–µ –ø—Ä–∏—î–º–Ω–∏–π –±–æ–Ω—É—Å –¥–ª—è –∑–∞–æ—â–∞–¥–∂–µ–Ω—å." }
    ];

    function applyEvent() {
        const event = events[Math.floor(Math.random() * events.length)];
        
        // –ó–º—ñ–Ω–∞ –≥–æ—Ç—ñ–≤–∫–∏
        gameData.cash += event.cash;

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–¥—ñ—é
        eventMessage.textContent = `–ü–æ–¥—ñ—è: ${event.name}! ${event.cash >= 0 ? '+' : ''}${event.cash} –≥—Ä–Ω.`;
        eventMessage.className = `mb-4 p-2 rounded text-sm font-medium ${event.type === 'good' ? 'bg-green-100 text-green-700' : event.type === 'bad' ? 'bg-red-100 text-red-700' : 'bg-yellow-100 text-yellow-700'}`;
        
        playTone(event.sound);
        
        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∑ –ø–æ—Ä–∞–¥–æ—é
        setCharacterState(event.type === 'good' ? 'victory' : event.type === 'bad' ? 'error' : 'thinking', event.advice);
    }
    
    // –õ–æ–≥—ñ–∫–∞ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è/–≤—Ç—Ä–∞—Ç
    function applyMonthlyInterest() {
        // 1. –ë–æ—Ä–≥ (–∑–∞–≤–∂–¥–∏ –∑—Ä–æ—Å—Ç–∞—î, —è–∫—â–æ —î)
        if (gameData.debt > 0) {
            const interest = gameData.debt * 0.05; // 5% —â–æ–º—ñ—Å—è—Ü—è
            gameData.debt += interest;
            playTone(150); // –ù–∏–∑—å–∫–∏–π, —Ç—Ä–∏–≤–æ–∂–Ω–∏–π —Ç–æ–Ω
        }
        
        // 2. –ó–∞–æ—â–∞–¥–∂–µ–Ω–Ω—è (–º–∞–ª–∏–π, —Å—Ç–∞–±—ñ–ª—å–Ω–∏–π –ø—Ä–∏—Ä—ñ—Å—Ç)
        if (gameData.savings > 0) {
            const interest = gameData.savings * 0.01; // 1% —â–æ–º—ñ—Å—è—Ü—è
            gameData.savings += interest;
        }

        // 3. –Ü–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó (–≤–∏—Å–æ–∫–∏–π —Ä–∏–∑–∏–∫/–≤–∏–Ω–∞–≥–æ—Ä–æ–¥–∞)
        if (gameData.investment > 0) {
            // –í–∏–ø–∞–¥–∫–æ–≤–∞ –∑–º—ñ–Ω–∞ –≤—ñ–¥ -10% –¥–æ +15%
            const changeFactor = (Math.random() * 0.25) - 0.10; 
            const change = gameData.investment * changeFactor;
            gameData.investment += change;
            
            if (change > 0) {
                playTone(880); // –£—Å–ø—ñ—Ö
            } else {
                playTone(330); // –í—Ç—Ä–∞—Ç–∞
            }
        }
    }

    // === –ö–µ—Ä—É–≤–∞–Ω–Ω—è –≤–≤–µ–¥–µ–Ω–Ω—è–º ===
    function validateAllocation() {
        let debtAmount = Math.max(0, parseInt(inputDebt.value) || 0);
        let investAmount = Math.max(0, parseInt(inputInvestment.value) || 0);
        let saveAmount = Math.max(0, parseInt(inputSavings.value) || 0);
        
        const currentCash = Math.round(gameData.cash);
        const totalAllocated = debtAmount + investAmount + saveAmount;
        
        // –û–±–º–µ–∂–µ–Ω–Ω—è: –Ω–µ –º–æ–∂–Ω–∞ –ø–æ–≥–∞—Å–∏—Ç–∏ –±—ñ–ª—å—à–µ –±–æ—Ä–≥—É, –Ω—ñ–∂ —î
        const actualDebtPaid = Math.min(debtAmount, gameData.debt);
        
        // –û–±–º–µ–∂–µ–Ω–Ω—è: –Ω–µ –º–æ–∂–Ω–∞ –≤–∏—Ç—Ä–∞—Ç–∏—Ç–∏ –±—ñ–ª—å—à–µ, –Ω—ñ–∂ —î –≥–æ—Ç—ñ–≤–∫–∏
        const availableCashForAllocation = currentCash;

        if (totalAllocated > availableCashForAllocation) {
            // –Ø–∫—â–æ –ø–µ—Ä–µ–≤–∏—â–µ–Ω–æ –ª—ñ–º—ñ—Ç, –æ–±–º–µ–∂—É—î–º–æ –æ—Å—Ç–∞–Ω–Ω—î –ø–æ–ª–µ
            const difference = totalAllocated - availableCashForAllocation;
            if (saveAmount > 0) {
                inputSavings.value = Math.max(0, saveAmount - difference);
            } else if (investAmount > 0) {
                inputInvestment.value = Math.max(0, investAmount - difference);
            } else {
                // –Ø–∫—â–æ –Ω–µ–º–æ–∂–ª–∏–≤–æ –æ–±–º–µ–∂–∏—Ç–∏, —Å–∫–∏–¥–∞—î–º–æ
                inputDebt.value = Math.max(0, debtAmount - difference);
            }
            // –ü–µ—Ä–µ—Ä–∞—Ö–æ–≤—É—î–º–æ –ø—ñ—Å–ª—è –∫–æ—Ä–µ–∫—Ü—ñ—ó
            debtAmount = Math.max(0, parseInt(inputDebt.value) || 0);
            investAmount = Math.max(0, parseInt(inputInvestment.value) || 0);
            saveAmount = Math.max(0, parseInt(inputSavings.value) || 0);
        }

        const finalAllocated = parseInt(inputDebt.value || 0) + parseInt(inputInvestment.value || 0) + parseInt(inputSavings.value || 0);
        const remaining = currentCash - finalAllocated;

        remainingCashDisplay.textContent = Math.round(remaining);
        remainingCashDisplay.classList.toggle('text-red-600', remaining < 0);
        remainingCashDisplay.classList.toggle('text-green-600', remaining >= 0);

        allocateButton.disabled = finalAllocated > currentCash;
    }

    // === –ì–æ–ª–æ–≤–Ω–∏–π —Ü–∏–∫–ª –≥—Ä–∏ ===
    function nextMonth() {
        if (currentMonth >= MAX_MONTHS) {
            endGame();
            return;
        }

        // 1. –ó–±—ñ—Ä –¥–∞–Ω–∏—Ö –∑ –ø–æ–ª—ñ–≤
        const debtPayment = Math.max(0, parseInt(inputDebt.value) || 0);
        const investment = Math.max(0, parseInt(inputInvestment.value) || 0);
        const savings = Math.max(0, parseInt(inputSavings.value) || 0);
        
        const totalAllocated = debtPayment + investment + savings;

        if (totalAllocated > gameData.cash) {
             // –¶—å–æ–≥–æ –Ω–µ –ø–æ–≤–∏–Ω–Ω–æ —Å—Ç–∞—Ç–∏—Å—è —á–µ—Ä–µ–∑ validateAllocation, –∞–ª–µ –¥–ª—è –±–µ–∑–ø–µ–∫–∏
            alert("–ü–æ–º–∏–ª–∫–∞ —Ä–æ–∑–ø–æ–¥—ñ–ª—É! –í–∏—Ç—Ä–∞—á–µ–Ω–æ –±—ñ–ª—å—à–µ –≥–æ—Ç—ñ–≤–∫–∏, –Ω—ñ–∂ –¥–æ—Å—Ç—É–ø–Ω–æ.");
            return;
        }

        // 2. –í–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä–æ–∑–ø–æ–¥—ñ–ª—É
        gameData.cash -= totalAllocated;
        
        // –ë–æ—Ä–≥: –Ω–µ –º–æ–∂–Ω–∞ –ø–æ–≥–∞—Å–∏—Ç–∏ –±—ñ–ª—å—à–µ, –Ω—ñ–∂ —î –±–æ—Ä–≥—É
        const actualDebtPaid = Math.min(debtPayment, gameData.debt);
        gameData.debt -= actualDebtPaid;
        
        gameData.investment += investment;
        gameData.savings += savings;

        // 3. –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —â–æ–º—ñ—Å—è—á–Ω–∏—Ö –≤—ñ–¥—Å–æ—Ç–∫—ñ–≤/–∑—Ä–æ—Å—Ç–∞–Ω–Ω—è
        applyMonthlyInterest();

        // 4. –ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –º—ñ—Å—è—Ü—è
        currentMonth++;
        
        // 5. –ù–æ–≤–∞ –ø–æ–¥—ñ—è —Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è UI
        if (currentMonth <= MAX_MONTHS) {
            applyEvent(); // –í–ø–ª–∏–≤ –Ω–∞ Cash
            updateUI();
            
            // –°–∫–∏–¥–∞–Ω–Ω—è –ø–æ–ª—ñ–≤ –≤–≤–µ–¥–µ–Ω–Ω—è
            inputDebt.value = 0;
            inputInvestment.value = 0;
            inputSavings.value = 0;
            remainingCashDisplay.textContent = Math.round(gameData.cash);
        } else {
            endGame();
        }

        validateAllocation();
    }

    function startGame() {
        initAudioContext(); // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è AudioContext –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –∫–ª—ñ–∫—É
        
        currentMonth = 1;
        gameData = {
            cash: 500,
            debt: 300,
            investment: 0,
            savings: 200,
            totalWealth: 400 
        };

        startButton.classList.add('hidden');
        allocationUI.classList.remove('hidden');
        allocateButton.disabled = false;
        
        // –°–∫–∏–¥–∞–Ω–Ω—è –ø–æ–ª—ñ–≤
        inputDebt.value = 0;
        inputInvestment.value = 0;
        inputSavings.value = 0;

        applyEvent(); // –ü–æ–¥—ñ—è –ø–µ—Ä—à–æ–≥–æ –º—ñ—Å—è—Ü—è
        updateUI();
        validateAllocation();
        setCharacterState('thinking', "–ü–æ—á–∞—Ç–∫–æ–≤–∏–π –∫–∞–ø—ñ—Ç–∞–ª —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–æ. –ß–∞—Å –ø—Ä–∏–π–º–∞—Ç–∏ –ø–µ—Ä—à—ñ —Ä—ñ—à–µ–Ω–Ω—è!");
    }

    function endGame() {
        allocateButton.disabled = true;
        
        const finalWealth = gameData.totalWealth;
        let resultMessage = `–ì—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –¢–≤—ñ–π —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π –∫–∞–ø—ñ—Ç–∞–ª: ${Math.round(finalWealth)} –≥—Ä–Ω.`;
        
        if (finalWealth > 2000) {
            resultMessage += " üèÜ –¢–∏ ‚Äî —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏–π –≥–µ–Ω—ñ–π! –ö–∞–ø—ñ—Ç–∞–ª –∑–Ω–∞—á–Ω–æ –∑—Ä—ñ—Å.";
            setCharacterState('victory', "–ù–µ–π–º–æ–≤—ñ—Ä–Ω–æ! –¶–µ –±—É–≤ –º–∞–π—Å—Ç–µ—Ä-–∫–ª–∞—Å –∑ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è!");
        } else if (finalWealth >= 1000) {
            resultMessage += " ‚úÖ –ß—É–¥–æ–≤–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –¢–∏ –∑–±–µ—Ä—ñ–≥ —ñ –ø—Ä–∏–º–Ω–æ–∂–∏–≤ –∫–∞–ø—ñ—Ç–∞–ª.";
            setCharacterState('thinking', "–•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –°–ø—Ä–æ–±—É–π –ø–æ–±–∏—Ç–∏ —Ü–µ–π —Ä–µ–∫–æ—Ä–¥!");
        } else {
            resultMessage += " üòî –ù–∞ –∂–∞–ª—å, –∫–∞–ø—ñ—Ç–∞–ª –∑–º–µ–Ω—à–∏–≤—Å—è. –í–∞—Ä—Ç–æ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é.";
            setCharacterState('error', "–ù–µ –∑–∞—Å–º—É—á—É–π—Å—è! –ù–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä–∞–∑—É –±—ñ–ª—å—à–µ —É–≤–∞–≥–∏ –ø—Ä–∏–¥—ñ–ª—è–π –±–æ—Ä–≥–∞–º.");
        }
        
        eventMessage.textContent = resultMessage;
        eventMessage.className = `mb-4 p-2 rounded text-base font-extrabold ${finalWealth >= 1000 ? 'bg-green-200 text-green-800' : 'bg-red-200 text-red-800'}`;

        startButton.textContent = "–ü–û–ß–ê–¢–ò –ó–ù–û–í–£";
        startButton.classList.remove('hidden');
        allocationUI.classList.add('hidden');
    }

    // === –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π ===
    startButton.addEventListener('click', startGame);
    allocateButton.addEventListener('click', nextMonth);
    
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–≤–µ–¥–µ–Ω–Ω—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
    inputDebt.addEventListener('input', validateAllocation);
    inputInvestment.addEventListener('input', validateAllocation);
    inputSavings.addEventListener('input', validateAllocation);

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å—Ç–∞–Ω—É UI
    updateUI();
    document.getElementById('remaining-cash').textContent = '';
</script>

</body>
</html>

