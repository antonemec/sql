<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–∏–≤–∞—Ç–Ω–∏–π –§—ñ–Ω–∞–Ω—Å–æ–≤–∏–π –ù–∞–≤—ñ–≥–∞—Ç–æ—Ä</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        
        /* === –ö–æ–ª—å–æ—Ä–æ–≤–∞ –°—Ö–µ–º–∞ –ü—Ä–∏–≤–∞—Ç–ë–∞–Ω–∫—É (—ñ–º—ñ—Ç–∞—Ü—ñ—è) === */
        :root {
            --privat-blue: #1e88e5; /* –û—Å–Ω–æ–≤–Ω–∏–π —Å–∏–Ω—ñ–π */
            --privat-green: #4caf50; /* –ê–∫—Ü–µ–Ω—Ç–Ω–∏–π –∑–µ–ª–µ–Ω–∏–π */
            --privat-dark: #374151;
            --bg-light: #f8f9fa;
            --cardman-primary: #FFC107; /* –ñ–æ–≤—Ç–∏–π */
            --cardman-secondary: #00897B; /* –ë—ñ—Ä—é–∑–æ–≤–∏–π */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-light); 
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 20px 10px;
        }
        .game-container {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 550px; 
            text-align: center;
        }
        
        /* === –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞ –°—Ç–∏–ª—ñ UI === */
        h1 { color: var(--privat-blue); font-weight: 800; }
        .card {
            background-color: #ffffff;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 12px;
            text-align: left;
        }
        .text-privat-blue { color: var(--privat-blue); }
        .bg-privat-blue { background-color: var(--privat-blue); }
        .bg-privat-green { background-color: var(--privat-green); }

        /* === –ö–Ω–æ–ø–∫–∏ === */
        .btn-primary {
            background-color: var(--privat-blue);
            color: white;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 700;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 0 #1565c0; /* –¢–µ–º–Ω—ñ—à–∏–π —Å–∏–Ω—ñ–π –¥–ª—è –µ—Ñ–µ–∫—Ç—É 3D */
            border: none;
            cursor: pointer;
        }
        .btn-primary:active:not(.disabled) {
            transform: translateY(3px);
            box-shadow: 0 1px 0 #1565c0;
        }
        .btn-primary.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* === –ê–Ω—ñ–º–∞—Ü—ñ—ó –ü–µ—Ä—Å–æ–Ω–∞–∂–∞ (Cardman) === */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-3px); }
            40%, 80% { transform: translateX(3px); }
        }

        .character-area {
            background-color: #e3f2fd; /* –î—É–∂–µ —Å–≤—ñ—Ç–ª–∏–π —Ñ–æ–Ω –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ */
            padding: 10px;
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .character-svg-wrapper {
            width: 70px;
            height: 70px;
            flex-shrink: 0;
            animation: pulse 2.5s infinite ease-in-out;
        }
        .character-text {
            flex-grow: 1;
            font-size: 0.95rem;
            color: var(--privat-dark);
            font-weight: 600;
            text-align: left;
        }

        /* –°—Ç–∏–ª—ñ SVG –¥–ª—è –µ–º–æ—Ü—ñ–π Cardman */
        .cardman-face, .cardman-mouth, .cardman-eye {
            transition: all 0.3s ease-in-out;
            transform-origin: center center;
        }
        .cardman-head { fill: var(--cardman-primary); }
        .cardman-body { fill: var(--cardman-secondary); }

        .character-svg-wrapper.error { animation: shake 0.5s 3; }
        .character-svg-wrapper.error .cardman-mouth { d: path("M 30 50 Q 40 45 50 50"); } /* –°—É–º–Ω–∏–π —Ä–æ—Ç */
        .character-svg-wrapper.error .cardman-eye { r: 3; } /* –ó–≤—É–∂–µ–Ω—ñ –æ—á—ñ */
        
        .character-svg-wrapper.victory .cardman-mouth { d: path("M 30 50 Q 40 60 50 50"); } /* –©–∞—Å–ª–∏–≤–∏–π —Ä–æ—Ç */
        .character-svg-wrapper.victory .cardman-eye { r: 5; } /* –ë—ñ–ª—å—à—ñ –æ—á—ñ */
        
        .character-svg-wrapper.thinking .cardman-mouth { d: path("M 30 52 Q 40 55 50 52"); } /* –ù–µ–π—Ç—Ä–∞–ª—å–Ω–∏–π/–∑–∞–¥—É–º–ª–∏–≤–∏–π */

        /* –°–ª–∞–π–¥–µ—Ä–∏ */
        .slider-input {
            width: 100%;
            -webkit-appearance: none;
            height: 8px;
            background: #ddd;
            border-radius: 4px;
            outline: none;
            opacity: 0.7;
            transition: opacity .15s;
        }
        .slider-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--privat-blue);
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        }
        /* –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–º–∏–ª–∫–∏ –≤—ñ–¥—Å–æ—Ç–∫—ñ–≤ */
        .error-message {
            color: #dc2626;
            font-size: 0.85rem;
            font-weight: 600;
            text-align: center;
            padding: 5px;
            border-radius: 6px;
            margin-top: 5px;
        }
        .info-message {
            color: #1e88e5; /* privat-blue */
            font-size: 0.85rem;
            font-weight: 600;
            text-align: center;
            padding: 5px;
            border-radius: 6px;
            margin-top: 5px;
        }
    </style>
    <!-- Font Awesome –¥–ª—è —ñ–∫–æ–Ω–æ–∫ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

<div class="game-container">
    <h1 class="text-2xl mb-1">–ü—Ä–∏–≤–∞—Ç–Ω–∏–π –§—ñ–Ω–∞–Ω—Å–æ–≤–∏–π –ù–∞–≤—ñ–≥–∞—Ç–æ—Ä</h1>
    <p class="text-sm text-gray-500 mb-4">–¶—ñ–ª—å: –¥–æ—Å—è–≥—Ç–∏ $15,000 –∫–∞–ø—ñ—Ç–∞–ª—É –∑–∞ 12 –º—ñ—Å—è—Ü—ñ–≤.</p>

    <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∞ –ø–∞–Ω–µ–ª—å -->
    <div class="card bg-gray-50 flex justify-between items-center text-privat-dark font-semibold">
        <span>–ú—ñ—Å—è—Ü—å: <span id="current-month">1 / 12</span></span>
        <div class="text-xl">
            –ö–∞–ø—ñ—Ç–∞–ª: <span id="total-wealth" class="font-extrabold text-privat-blue">0</span> $
        </div>
    </div>
    
    <!-- –°–µ–∫—Ü—ñ—è –ü–µ—Ä—Å–æ–Ω–∞–∂–∞ —Ç–∞ –ü–æ—Ä–∞–¥–Ω–∏–∫–∞ (Cardman) -->
    <div class="character-area">
        <div class="character-svg-wrapper" id="character-svg-wrapper">
            <!-- SVG Cardman -->
            <svg width="70" height="70" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
                <!-- –¢—ñ–ª–æ (–ö–æ—Ä–ø—É—Å-–ö–∞—Ä—Ç–∞) -->
                <rect x="15" y="15" width="50" height="50" rx="10" class="cardman-body" fill="var(--cardman-secondary)"/>
                
                <!-- –ì–æ–ª–æ–≤–∞ -->
                <circle cx="40" cy="20" r="15" class="cardman-head"/>
                
                <!-- –û—á—ñ -->
                <circle cx="35" cy="20" r="4" fill="white" class="cardman-eye"/>
                <circle cx="45" cy="20" r="4" fill="white" class="cardman-eye"/>
                
                <!-- –†–æ—Ç (–¥–ª—è –µ–º–æ—Ü—ñ–π) -->
                <path d="M 30 52 Q 40 55 50 52" stroke="white" stroke-width="2" stroke-linecap="round" fill="none" class="cardman-mouth"/>
            </svg>
        </div>
        <div class="character-text" id="character-text">–ü—Ä–∏–≤—ñ—Ç! –Ø —Ç–≤—ñ–π –æ—Å–æ–±–∏—Å—Ç–∏–π —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç. –ù–∞—Ç–∏—Å–Ω–∏ "–°—Ç–∞—Ä—Ç"!</div>
    </div>

    <!-- –†–µ—Å—É—Ä—Å–∏ (–ü–∞–Ω–µ–ª—å –ü—Ä–∏–≤–∞—Ç24) -->
    <div class="grid grid-cols-2 gap-3 mb-4">
        <div class="card bg-blue-50">
            <div class="text-xs text-gray-600 font-medium">üíµ –ì–æ—Ç—ñ–≤–∫–∞ (–§–æ–Ω–¥ –ñ–∏—Ç—Ç—è)</div>
            <div class="text-xl font-bold text-privat-dark"><span id="cash-display">0</span> $</div>
        </div>
        <div class="card bg-green-50">
            <div class="text-xs text-gray-600 font-medium">üìà –Ü–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó (–Ü–Ω–¥–µ–∫—Å UA)</div>
            <div class="text-xl font-bold text-privat-dark"><span id="investment-display">0</span> $</div>
        </div>
        <div class="card bg-red-50">
            <div class="text-xs text-gray-600 font-medium">üî• –ë–æ—Ä–≥ (–ö—Ä–µ–¥–∏—Ç–Ω–∞ –ª—ñ–Ω—ñ—è)</div>
            <div class="text-xl font-bold text-privat-dark"><span id="debt-display">0</span> $</div>
        </div>
        <div class="card bg-yellow-50">
            <div class="text-xs text-gray-600 font-medium">üí∞ –î–µ–ø–æ–∑–∏—Ç (–ó–∞–æ—â–∞–¥–∂–µ–Ω–Ω—è)</div>
            <div class="text-xl font-bold text-privat-dark"><span id="savings-display">0</span> $</div>
        </div>
    </div>

    <button id="start-button" class="btn-primary w-full mt-2">–ü–û–ß–ê–¢–ò –ì–†–£</button>
    
    <!-- –°–µ–∫—Ü—ñ—è —Ä–æ–∑–ø–æ–¥—ñ–ª—É –∫–æ—à—Ç—ñ–≤ (–≤–∏–¥–∏–º–∞ —Ç—ñ–ª—å–∫–∏ –ø—ñ–¥ —á–∞—Å –≥—Ä–∏) -->
    <div id="allocation-ui" class="card bg-blue-50 hidden">
        <h3 class="text-lg font-bold text-privat-blue mb-3">–í–∞—à –º—ñ—Å—è—á–Ω–∏–π –¥–æ—Ö—ñ–¥: <span id="monthly-income" class="text-privat-green">0</span> $</h3>
        <div id="market-news" class="mb-4 p-3 rounded text-sm font-medium bg-white border border-gray-200">
            –†–∏–Ω–∫–æ–≤—ñ –Ω–æ–≤–∏–Ω–∏: –Ü–Ω–¥–µ–∫—Å UA —Å—Ç–∞–±—ñ–ª—å–Ω–∏–π.
        </div>

        <!-- –ü–æ–ª—è —Ä–æ–∑–ø–æ–¥—ñ–ª—É (–°–ª–∞–π–¥–µ—Ä–∏) -->
        <div id="sliders-container">
            <!-- –ë–æ—Ä–≥ -->
            <div class="mb-3">
                <div class="flex justify-between items-center mb-1 text-sm font-semibold">
                    <label class="text-red-600"><i class="fas fa-fire"></i> –ü–æ–≥–∞—Å–∏—Ç–∏ –ë–æ—Ä–≥:</label>
                    <span id="debt-percent-value">0%</span>
                </div>
                <input type="range" min="0" max="100" value="0" id="input-debt" class="slider-input" data-target="debt">
            </div>
            
            <!-- –Ü–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó -->
            <div class="mb-3">
                <div class="flex justify-between items-center mb-1 text-sm font-semibold">
                    <label class="text-green-600"><i class="fas fa-chart-line"></i> –Ü–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó (–ê–∫—Ü—ñ—ó):</label>
                    <span id="investment-percent-value">0%</span>
                </div>
                <input type="range" min="0" max="100" value="0" id="input-investment" class="slider-input" data-target="investment">
            </div>
            
            <!-- –î–µ–ø–æ–∑–∏—Ç -->
            <div class="mb-3">
                <div class="flex justify-between items-center mb-1 text-sm font-semibold">
                    <label class="text-yellow-600"><i class="fas fa-piggy-bank"></i> –î–µ–ø–æ–∑–∏—Ç (–ó–∞–æ—â–∞–¥–∂–µ–Ω–Ω—è):</label>
                    <span id="savings-percent-value">0%</span>
                </div>
                <input type="range" min="0" max="100" value="0" id="input-savings" class="slider-input" data-target="savings">
            </div>

            <!-- –ì–æ—Ç—ñ–≤–∫–∞ (–ó–ê–õ–ò–®–û–ö) -->
            <div class="mb-3">
                <div class="flex justify-between items-center mb-1 text-sm font-semibold">
                    <label class="text-blue-600"><i class="fas fa-wallet"></i> –ó–∞–ª–∏—à–∏—Ç–∏ –ì–æ—Ç—ñ–≤–∫–æ—é:</label>
                    <span id="cash-percent-value">100%</span>
                </div>
                <!-- –¶–µ –ø–æ–ª–µ –ª–∏—à–µ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–æ–≥–æ –∑–∞–ª–∏—à–∫—É -->
                <input type="range" min="0" max="100" value="100" id="input-cash" class="slider-input" disabled>
            </div>
        </div>

        <div id="allocation-message" class="info-message">
             ‚ÑπÔ∏è –ë—É–¥—å-—è–∫–∏–π –Ω–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –≤—ñ–¥—Å–æ—Ç–æ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å —É –ì–æ—Ç—ñ–≤–∫—É.
        </div>

        <button id="allocate-button" class="btn-primary w-full mt-3 disabled:opacity-50" disabled>
            <i class="fas fa-arrow-right"></i> –ü–ï–†–ï–ô–¢–ò –î–û –ù–ê–°–¢–£–ü–ù–û–ì–û –ú–Ü–°–Ø–¶–Ø
        </button>
    </div>
    
    <!-- –§—ñ–Ω–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è -->
    <div id="final-message" class="mt-4 p-4 rounded-lg text-lg font-bold hidden"></div>
</div>

<script>
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è DOM –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
    const startButton = document.getElementById('start-button');
    const allocateButton = document.getElementById('allocate-button');
    const allocationUI = document.getElementById('allocation-ui');
    const characterSvgWrapper = document.getElementById('character-svg-wrapper');
    const characterText = document.getElementById('character-text');
    const monthDisplay = document.getElementById('current-month');
    const totalWealthDisplay = document.getElementById('total-wealth');
    const marketNewsDisplay = document.getElementById('market-news');
    const finalMessage = document.getElementById('final-message');
    const allocationMessage = document.getElementById('allocation-message'); // –ó–º—ñ–Ω–µ–Ω–æ ID
    const monthlyIncomeDisplay = document.getElementById('monthly-income');

    // –î–∏—Å–ø–ª–µ—ó —Ä–µ—Å—É—Ä—Å—ñ–≤
    const cashDisplay = document.getElementById('cash-display');
    const debtDisplay = document.getElementById('debt-display');
    const investmentDisplay = document.getElementById('investment-display');
    const savingsDisplay = document.getElementById('savings-display');

    // –ü–æ–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è (–°–ª–∞–π–¥–µ—Ä–∏)
    const inputDebt = document.getElementById('input-debt');
    const inputInvestment = document.getElementById('input-investment');
    const inputSavings = document.getElementById('input-savings');
    const inputCash = document.getElementById('input-cash'); // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–∞–ª–∏—à–∫—É
    
    // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤—ñ–¥—Å–æ—Ç–∫—ñ–≤
    const debtPercentValue = document.getElementById('debt-percent-value');
    const investmentPercentValue = document.getElementById('investment-percent-value');
    const savingsPercentValue = document.getElementById('savings-percent-value');
    const cashPercentValue = document.getElementById('cash-percent-value');

    const inputs = [inputDebt, inputInvestment, inputSavings];

    // === –Ü–≥—Ä–æ–≤—ñ –ó–º—ñ–Ω–Ω—ñ ===
    let gameData = {};
    let currentMonth = 0;
    const MAX_MONTHS = 12;
    const BASE_INCOME = 1500; // –ë–∞–∑–æ–≤–∏–π —â–æ–º—ñ—Å—è—á–Ω–∏–π –¥–æ—Ö—ñ–¥
    let audioContext = null; 

    // === –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ó–≤—É–∫—É ===
    function initAudioContext() {
        if (!audioContext) {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.error("AudioContext initialization failed:", e);
            }
        }
    }

    function playTone(freq, duration = 0.1) {
        if (!audioContext) return;

        try {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + duration);

            oscillator.start();
            oscillator.stop(audioContext.currentTime + duration);
        } catch (e) {
            console.error("Error playing tone:", e);
        }
    }

    // === –õ–æ–≥—ñ–∫–∞ –ü–µ—Ä—Å–æ–Ω–∞–∂–∞ —Ç–∞ UI ===
    function setCharacterState(state = 'idle', text = '') {
        characterSvgWrapper.classList.remove('error', 'thinking', 'victory');
        if (state !== 'idle') {
            characterSvgWrapper.classList.add(state);
        }
        if (text) {
            characterText.textContent = text;
        }
    }

    function updateUI() {
        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤
        cashDisplay.textContent = Math.round(gameData.cash);
        debtDisplay.textContent = Math.round(gameData.debt);
        investmentDisplay.textContent = Math.round(gameData.investment);
        savingsDisplay.textContent = Math.round(gameData.savings);

        // –û–±—á–∏—Å–ª–µ–Ω–Ω—è –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ –∫–∞–ø—ñ—Ç–∞–ª—É
        gameData.totalWealth = gameData.cash + gameData.investment + gameData.savings - gameData.debt;
        totalWealthDisplay.textContent = Math.round(gameData.totalWealth);
        monthDisplay.textContent = `${currentMonth} / ${MAX_MONTHS}`;
        
        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–ª—å–æ—Ä—É –∫–∞–ø—ñ—Ç–∞–ª—É
        const wealthColor = gameData.totalWealth >= 5000 ? 'text-privat-green' : 
                            gameData.totalWealth >= 0 ? 'text-privat-blue' : 'text-red-600';
        totalWealthDisplay.className = `font-extrabold ${wealthColor}`;
    }
    
    // === –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ç–∞ –ö–µ—Ä—É–≤–∞–Ω–Ω—è –°–ª–∞–π–¥–µ—Ä–∞–º–∏ (–û–ù–û–í–õ–ï–ù–û) ===
    function getPercentValues() {
        return {
            debt: parseInt(inputDebt.value),
            investment: parseInt(inputInvestment.value),
            savings: parseInt(inputSavings.value),
        };
    }

    // –ü—Ä–∏–π–º–∞—î –µ–ª–µ–º–µ–Ω—Ç, —è–∫–∏–π –±—É–≤ –∑–º—ñ–Ω–µ–Ω–∏–π (–¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –æ–±–º–µ–∂–µ–Ω–Ω—è)
    function validateAllocation(changedInput = null) {
        let { debt, investment, savings } = getPercentValues();
        let total = debt + investment + savings;
        
        const messageElement = allocationMessage;

        // 1. –ê–í–¢–û–ú–ê–¢–ò–ß–ù–ï –û–ë–ú–ï–ñ–ï–ù–ù–Ø: –°—É–º–∞ —Ç—Ä—å–æ—Ö –æ—Å–Ω–æ–≤–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –Ω–µ –º–æ–∂–µ –ø–µ—Ä–µ–≤–∏—â—É–≤–∞—Ç–∏ 100%
        if (total > 100 && changedInput) {
            const excess = total - 100;
            
            // –í—ñ–¥–Ω—ñ–º–∞—î–º–æ –Ω–∞–¥–ª–∏—à–æ–∫ –≤—ñ–¥ –∑–Ω–∞—á–µ–Ω–Ω—è –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –∑–º—ñ–Ω–µ–Ω–æ–≥–æ —Å–ª–∞–π–¥–µ—Ä–∞
            let newValue = parseInt(changedInput.value) - excess;
            changedInput.value = Math.max(0, newValue); // –û–±–º–µ–∂—É—î–º–æ –º—ñ–Ω—ñ–º—É–º 0
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –ø—ñ—Å–ª—è –∫–æ—Ä–µ–∫—Ü—ñ—ó
            ({ debt, investment, savings } = getPercentValues());
            total = debt + investment + savings;
            
            // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Ç–∏–º—á–∞—Å–æ–≤–∏–π —Ç–µ–∫—Å—Ç –ø—Ä–æ –∞–≤—Ç–æ–∫–æ—Ä–µ–∫—Ü—ñ—é
            messageElement.classList.remove('error-message', 'info-message');
            messageElement.classList.add('info-message');
            messageElement.textContent = `‚úÖ –ê–≤—Ç–æ–∫–æ—Ä–µ–∫—Ü—ñ—è: —Ä–æ–∑–ø–æ–¥—ñ–ª –æ–±–º–µ–∂–µ–Ω–æ –¥–æ 100%.`;
            
            // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∞–≤—Ç–æ–∫–æ—Ä–µ–∫—Ü—ñ—é —á–µ—Ä–µ–∑ 1.5 —Å–µ–∫
            setTimeout(() => {
                if (total > 0 && total < 100) {
                    messageElement.textContent = `‚ÑπÔ∏è ${100 - total}% –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å —É –ì–æ—Ç—ñ–≤–∫—É (–§–æ–Ω–¥ –ñ–∏—Ç—Ç—è).`;
                } else if (total === 100) {
                    messageElement.classList.add('hidden');
                }
            }, 1500);
        }

        // 2. –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∑–∞–ª–∏—à–∫—É, —è–∫–∏–π –π–¥–µ —É –ì–æ—Ç—ñ–≤–∫—É (Cash)
        const cashRemaining = 100 - total;
        
        // 3. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤—ñ–¥—Å–æ—Ç–∫—ñ–≤
        debtPercentValue.textContent = `${debt}%`;
        investmentPercentValue.textContent = `${investment}%`;
        savingsPercentValue.textContent = `${savings}%`;
        
        cashPercentValue.textContent = `${cashRemaining}%`;
        inputCash.value = cashRemaining; // –î–ª—è –≤—ñ–∑—É–∞–ª—å–Ω–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è

        // 4. –õ–æ–≥—ñ–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–∞—Å—Ç—É–ø–Ω–∏–π –º—ñ—Å—è—Ü—å" —Ç–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
        messageElement.classList.remove('hidden', 'error-message', 'info-message');
        
        if (total === 0) {
             // –Ø–∫—â–æ –Ω—ñ—á–æ–≥–æ –Ω–µ —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–æ (0% –Ω–∞ –≤—Å–µ)
             allocateButton.disabled = true;
             messageElement.classList.add('error-message');
             messageElement.textContent = `‚ö†Ô∏è –ó–∞–≥–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª: 0%. –†–æ–∑–ø–æ–¥—ñ–ª–∏ —Ö–æ—á–∞ –± 1% —É –±—É–¥—å-—è–∫—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é!`;
        } else {
             // –í–∞–ª—ñ–¥–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª (Total > 0 —ñ <= 100)
             allocateButton.disabled = false;
             if (total < 100) {
                 messageElement.classList.add('info-message');
                 messageElement.textContent = `‚ÑπÔ∏è ${cashRemaining}% –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å —É –ì–æ—Ç—ñ–≤–∫—É (–§–æ–Ω–¥ –ñ–∏—Ç—Ç—è).`;
             } else {
                 // 100% —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–æ –º—ñ–∂ —Ç—Ä—å–æ–º–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏
                 messageElement.classList.add('hidden');
             }
        }
    }
    
    // === –Ü–≥—Ä–æ–≤–∞ –õ–æ–≥—ñ–∫–∞ —Ç–∞ –ü–æ–¥—ñ—ó (–±–µ–∑ –∑–º—ñ–Ω) ===
    const marketTrends = [
        { name: "–°–∏–ª—å–Ω–µ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è –Ü–Ω–¥–µ–∫—Å—É UA", factor: 0.15, sound: 770, advice: "–ê–∫—Ü—ñ—ó —Ä–æ—Å—Ç—É—Ç—å! –ß–∞—Å —ñ–Ω–≤–µ—Å—Ç—É–≤–∞—Ç–∏, –∞–ª–µ –Ω–µ –∑–∞–±—É–≤–∞–π –ø—Ä–æ –¥–∏–≤–µ—Ä—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—é." },
        { name: "–°—Ç–∞–±—ñ–ª—å–Ω–∏–π —Ä–∏–Ω–æ–∫", factor: 0.05, sound: 550, advice: "–ù–∞ —Ä–∏–Ω–∫—É —Å–ø–æ–∫—ñ–π. –ú–æ–∂–ª–∏–≤–æ, –≤–∞—Ä—Ç–æ –∑–±—ñ–ª—å—à–∏—Ç–∏ –¥–µ–ø–æ–∑–∏—Ç –¥–ª—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ–≥–æ –¥–æ—Ö–æ–¥—É." },
        { name: "–ö–æ—Ä–µ–∫—Ü—ñ—è —Ä–∏–Ω–∫—É (–Ω–µ–≤–µ–ª–∏–∫–µ –ø–∞–¥—ñ–Ω–Ω—è)", factor: -0.05, sound: 330, advice: "–†–∏–Ω–æ–∫ —Ç—Ä–æ—Ö–∏ –ø—Ä–æ—Å—ñ–≤. –ù–µ –ø–∞–Ω—ñ–∫—É–π, –∞–ª–µ –±—É–¥—å –æ–±–µ—Ä–µ–∂–Ω–∏–º –∑ —ñ–Ω–≤–µ—Å—Ç–∏—Ü—ñ—è–º–∏." },
        { name: "–ö—Ä–∏–∑–∞: —Å–∏–ª—å–Ω–µ –ø–∞–¥—ñ–Ω–Ω—è –Ü–Ω–¥–µ–∫—Å—É UA", factor: -0.15, sound: 180, advice: "–†–∏–Ω–∫–æ–≤–∞ –∫—Ä–∏–∑–∞! –Ø–∫—â–æ —Ç–∏ –º–∞—î—à –≥–æ—Ç—ñ–≤–∫—É, —Ü–µ –º–æ–∂–µ –±—É—Ç–∏ —á–∞—Å –¥–ª—è –∫—É–ø—ñ–≤–ª—ñ –∞–∫—Ü—ñ–π –∑—ñ –∑–Ω–∏–∂–∫–æ—é." }
    ];

    const lifeEvents = [
        { name: "–ù–µ—Å–ø–æ–¥—ñ–≤–∞–Ω–∏–π –º–µ–¥–∏—á–Ω–∏–π —Ä–∞—Ö—É–Ω–æ–∫", cost: 800, type: 'bad', advice: "–í–∏—Ç—Ä–∞—Ç–∏ –Ω–∞ –∑–¥–æ—Ä–æ–≤'—è! –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –§–æ–Ω–¥ –ñ–∏—Ç—Ç—è (–ì–æ—Ç—ñ–≤–∫—É), —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –±–æ—Ä–≥—É." },
        { name: "–ü—Ä–µ–º—ñ—è –≤—ñ–¥ –∫–µ—Ä—ñ–≤–Ω–∏—Ü—Ç–≤–∞", cost: -1000, type: 'good', advice: "–í—ñ—Ç–∞—é! –ù–µ—Å–ø–æ–¥—ñ–≤–∞–Ω–∏–π –±–æ–Ω—É—Å. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –π–æ–≥–æ –¥–ª—è –ø–æ–≥–∞—à–µ–Ω–Ω—è –±–æ—Ä–≥—É —á–∏ —ñ–Ω–≤–µ—Å—Ç–∏—Ü—ñ–π." },
        { name: "–ü–æ–ª–æ–º–∫–∞ –∞–≤—Ç–æ–º–æ–±—ñ–ª—è", cost: 500, type: 'bad', advice: "–î–æ—Ä–æ–≥–∏–π —Ä–µ–º–æ–Ω—Ç. –ì–æ—Ç—ñ–≤–∫–∞ –∑–∞—Ä–∞–∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–∞." },
        { name: "–ó–∞–ø—Ä–æ—à–µ–Ω–Ω—è –Ω–∞ –≤–µ—Å—ñ–ª–ª—è", cost: 300, type: 'bad', advice: "–ü—Ä–∏—î–º–Ω–∞ –ø–æ–¥—ñ—è, –∞–ª–µ –Ω–µ—Å–µ –≤–∏—Ç—Ä–∞—Ç–∏. –°–ø–æ–¥—ñ–≤–∞–π—Å—è, —É —Ç–µ–±–µ —î –≥–æ—Ç—ñ–≤–∫–∞." }
    ];

    let currentIncome = BASE_INCOME;
    let currentMarketTrend = marketTrends[1]; // –ü–æ—á–∏–Ω–∞—î–º–æ –∑—ñ —Å—Ç–∞–±—ñ–ª—å–Ω–æ–≥–æ

    function applyEventAndTrend() {
        const trend = marketTrends[Math.floor(Math.random() * marketTrends.length)];
        const lifeEvent = lifeEvents[Math.floor(Math.random() * lifeEvents.length)];

        // –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∂–∏—Ç—Ç—î–≤–æ—ó –ø–æ–¥—ñ—ó (—è–∫—â–æ –≤–æ–Ω–∞ —î)
        if (Math.random() < 0.5) { // 50% —à–∞–Ω—Å –Ω–∞ –ø–æ–¥—ñ—é
            marketNewsDisplay.innerHTML = `<i class="fas fa-exclamation-triangle"></i> –ñ–∏—Ç—Ç—î–≤–∞ –ü–æ–¥—ñ—è: ${lifeEvent.name} (${lifeEvent.cost >= 0 ? '-' : ''}${Math.abs(lifeEvent.cost)}$).`;
            gameData.cash -= lifeEvent.cost;
            
            // –Ø–∫—â–æ –≥–æ—Ç—ñ–≤–∫–∏ —Å—Ç–∞–ª–æ –º–µ–Ω—à–µ 0, –≤–∏–Ω–∏–∫–∞—î –±–æ—Ä–≥
            if (gameData.cash < 0) {
                gameData.debt += Math.abs(gameData.cash);
                gameData.cash = 0;
                setCharacterState('error', `–û–π! –ü–æ–¥—ñ—è —Å–ø—Ä–∏—á–∏–Ω–∏–ª–∞ ${Math.round(gameData.debt)} $ –±–æ—Ä–≥—É. ${trend.advice}`);
                playTone(100);
            } else {
                setCharacterState('thinking', `${lifeEvent.advice}. –†–∏–Ω–æ–∫ –∑–∞—Ä–∞–∑: ${trend.name}.`);
                playTone(600);
            }
        } else {
            marketNewsDisplay.innerHTML = `<i class="fas fa-chart-bar"></i> –†–∏–Ω–∫–æ–≤—ñ –ù–æ–≤–∏–Ω–∏: ${trend.name} (${(trend.factor * 100).toFixed(1)}%).`;
            setCharacterState(trend.factor > 0.05 ? 'victory' : trend.factor < 0 ? 'error' : 'thinking', trend.advice);
            playTone(trend.sound);
        }
        
        currentMarketTrend = trend;
    }
    
    // –õ–æ–≥—ñ–∫–∞ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è/–≤—Ç—Ä–∞—Ç –ø—ñ—Å–ª—è —Ä–æ–∑–ø–æ–¥—ñ–ª—É
    function applyMonthlyChanges() {
        // 1. –ë–æ—Ä–≥ (–∑–∞–≤–∂–¥–∏ –∑—Ä–æ—Å—Ç–∞—î)
        if (gameData.debt > 0) {
            const interest = gameData.debt * 0.03; // 3% —â–æ–º—ñ—Å—è—Ü—è
            gameData.debt += interest;
        }
        
        // 2. –î–µ–ø–æ–∑–∏—Ç (—Å—Ç–∞–±—ñ–ª—å–Ω–∏–π –ø—Ä–∏—Ä—ñ—Å—Ç)
        if (gameData.savings > 0) {
            const interest = gameData.savings * 0.005; // 0.5% —â–æ–º—ñ—Å—è—Ü—è
            gameData.savings += interest;
        }

        // 3. –Ü–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó (–∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –ø–æ—Ç–æ—á–Ω–æ—ó —Ç–µ–Ω–¥–µ–Ω—Ü—ñ—ó)
        if (gameData.investment > 0) {
            const change = gameData.investment * currentMarketTrend.factor;
            gameData.investment += change;
        }
    }

    // === –ì–æ–ª–æ–≤–Ω–∏–π —Ü–∏–∫–ª –≥—Ä–∏ ===
    function nextMonth() {
        if (currentMonth >= MAX_MONTHS) {
            endGame();
            return;
        }

        const { debt, investment, savings } = getPercentValues();
        // CashRemaining –≤–∂–µ –≥–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–æ –Ω–µ –º–µ–Ω—à–µ 0 –∑–∞–≤–¥—è–∫–∏ validateAllocation
        const cashRemaining = 100 - (debt + investment + savings);

        // 1. –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —Ä–æ–∑–ø–æ–¥—ñ–ª—É –∫–æ—à—Ç—ñ–≤
        const income = currentIncome;
        
        // –î–æ–¥–∞—î–º–æ –¥–æ –ì–æ—Ç—ñ–≤–∫–∏ (–∑–∞–ª–∏—à–æ–∫)
        gameData.cash += income * (cashRemaining / 100);
        
        // –ó–±—ñ–ª—å—à—É—î–º–æ –Ü–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó —Ç–∞ –ó–∞–æ—â–∞–¥–∂–µ–Ω–Ω—è
        gameData.investment += income * (investment / 100);
        gameData.savings += income * (savings / 100);
        
        // –ü–æ–≥–∞—à–µ–Ω–Ω—è –±–æ—Ä–≥—É (–Ω–µ –º–æ–∂–Ω–∞ –ø–æ–≥–∞—Å–∏—Ç–∏ –±—ñ–ª—å—à–µ, –Ω—ñ–∂ —î)
        const debtPayment = income * (debt / 100);
        gameData.debt = Math.max(0, gameData.debt - debtPayment); 
        
        // 2. –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —â–æ–º—ñ—Å—è—á–Ω–∏—Ö –∑–º—ñ–Ω (–≤—ñ–¥—Å–æ—Ç–∫–∏, –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è)
        applyMonthlyChanges();

        // 3. –ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –º—ñ—Å—è—Ü—è
        currentMonth++;
        
        // 4. –ù–æ–≤–∞ –ø–æ–¥—ñ—è —Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è UI
        if (currentMonth <= MAX_MONTHS) {
            applyEventAndTrend(); 
            updateUI();
            
            // –°–∫–∏–¥–∞–Ω–Ω—è —Å–ª–∞–π–¥–µ—Ä—ñ–≤ –Ω–∞ –Ω—É–ª—å
            inputs.forEach(input => input.value = 0);
            validateAllocation(null);
        } else {
            endGame();
        }
    }

    function startGame() {
        initAudioContext(); // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è AudioContext
        
        currentMonth = 1;
        gameData = {
            cash: 2000,
            debt: 1000, // –ü–æ—á–∏–Ω–∞—î–º–æ –∑ –Ω–µ–≤–µ–ª–∏–∫–æ–≥–æ –±–æ—Ä–≥—É
            investment: 0,
            savings: 1000,
            totalWealth: 2000 
        };
        currentIncome = BASE_INCOME;
        monthlyIncomeDisplay.textContent = currentIncome;

        startButton.classList.add('hidden');
        allocationUI.classList.remove('hidden');
        finalMessage.classList.add('hidden');
        
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ–ª—ñ–≤
        inputs.forEach(input => input.value = 0);
        validateAllocation(null); 

        applyEventAndTrend(); 
        updateUI();
        setCharacterState('thinking', "–ü–æ—á–∏–Ω–∞—î–º–æ 1-–π –º—ñ—Å—è—Ü—å. –†–æ–∑–ø–æ–¥—ñ–ª–∏ —Å–≤—ñ–π –¥–æ—Ö—ñ–¥ 100%!");
    }

    function endGame() {
        allocateButton.disabled = true;
        
        const finalWealth = gameData.totalWealth;
        const goal = 15000;
        let resultMessage = `–ì—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –¢–≤—ñ–π —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π –∫–∞–ø—ñ—Ç–∞–ª: ${Math.round(finalWealth)}$ –∑–∞ ${MAX_MONTHS} –º—ñ—Å—è—Ü—ñ–≤.`;
        
        finalMessage.classList.remove('hidden');
        finalMessage.classList.add(finalWealth >= goal ? 'bg-privat-green' : 'bg-red-400');

        if (finalWealth >= goal) {
            resultMessage += " üéâ –¢–ò –î–û–°–Ø–ì –ú–ï–¢–ò! –¶–µ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è –º—ñ–ª—å–π–æ–Ω–µ—Ä–∞.";
            setCharacterState('victory', "–ù–µ–π–º–æ–≤—ñ—Ä–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –í–∏ ‚Äî —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏–π –ø—Ä–æ—Ñ–µ—Å—ñ–æ–Ω–∞–ª.");
        } else if (finalWealth >= 5000) {
            resultMessage += " ‚úÖ –•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ö–∞–ø—ñ—Ç–∞–ª –∑—Ä—ñ—Å, –∞–ª–µ –º–µ—Ç–∞ –Ω–µ –¥–æ—Å—è–≥–Ω—É—Ç–∞.";
            setCharacterState('thinking', "–ù–µ–ø–æ–≥–∞–Ω–æ, –∞–ª–µ –¥–ª—è –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è —Ü—ñ–ª—ñ –ø–æ—Ç—Ä—ñ–±–µ–Ω –±—ñ–ª—å—à–∏–π —Ä–∏–∑–∏–∫!");
        } else {
            resultMessage += " üòî –¢–∏ –Ω–µ –¥–æ—Å—è–≥ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ—ó —Å—Ç—ñ–π–∫–æ—Å—Ç—ñ. –¢—Ä–µ–±–∞ —Ä—ñ—à—É—á—ñ—à–µ –±–æ—Ä–æ—Ç–∏—Å—è –∑ –±–æ—Ä–≥–∞–º–∏.";
            setCharacterState('error', "–°–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑, –∑–≤–µ—Ä—Ç–∞—é—á–∏ —É–≤–∞–≥—É –Ω–∞ –Ü–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó —Ç–∞ –ë–æ—Ä–≥–∏.");
        }
        
        finalMessage.textContent = resultMessage;

        startButton.textContent = "–ü–û–ß–ê–¢–ò –ù–û–í–£ –ì–†–£";
        startButton.classList.remove('hidden');
        allocationUI.classList.add('hidden');
    }

    // === –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π ===
    startButton.addEventListener('click', startGame);
    allocateButton.addEventListener('click', nextMonth);
    
    // –û–ù–û–í–õ–ï–ù–ù–Ø: –ü—Ä–∏–≤'—è–∑–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –¥–æ –≤—Å—ñ—Ö —Å–ª–∞–π–¥–µ—Ä—ñ–≤ –∑ –ø–µ—Ä–µ–¥–∞—á–µ—é –µ–ª–µ–º–µ–Ω—Ç–∞, —è–∫–∏–π –∑–º—ñ–Ω–∏–≤—Å—è
    inputs.forEach(input => {
        input.addEventListener('input', (event) => validateAllocation(event.target));
    });

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å—Ç–∞–Ω—É UI
    updateUI();
    validateAllocation(null); // –ü–æ—á–∞—Ç–∫–æ–≤–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
</script>

</body>
</html>
